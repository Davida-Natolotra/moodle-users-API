<div class="min-h-screen bg-gray-100 p-4 sm:p-8">
  <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-6 md:p-10">
    <h1 class="text-3xl font-extrabold text-blue-800 mb-2">Organisation Unit Selector</h1>
    <p class="text-gray-600 mb-8">
      Select units sequentially. The options in subsequent fields are filtered based on the parent
      ID of the selected unit.
    </p>

    <form [formGroup]="ouForm" class="space-y-6">
      <!-- Level 2 Selector -->
      <div class="form-group">
        <label for="level2" class="block text-sm font-medium text-gray-700 mb-1">
          Level 2 (Global HQ)
        </label>
        <select
          id="level2"
          formControlName="level2"
          class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out bg-white"
          [class.bg-gray-50]="level2Options().length === 0"
        >
          <option value="" disabled selected>Select Level 2 Unit</option>
          @for (unit of level2Options(); track unit.id) {
          <option [value]="unit.id">{{ unit.name }} ({{ unit.id }})</option>
          } @empty {
          <option disabled>No units available at this level</option>
          }
        </select>
        @if (ouForm.get('level2')?.touched && ouForm.get('level2')?.invalid) {
        <p class="mt-1 text-sm text-red-600">Level 2 selection is required.</p>
        }
      </div>

      <!-- Level 3 Selector -->
      <div class="form-group">
        <label for="level3" class="block text-sm font-medium text-gray-700 mb-1">
          Level 3 (Region)
        </label>
        <select
          id="level3"
          formControlName="level3"
          class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
          [class.bg-gray-100]="ouForm.get('level3')?.disabled"
          [disabled]="ouForm.get('level3')?.disabled"
        >
          <option value="" disabled selected>Select Level 3 Unit</option>
          @for (unit of level3Options(); track unit.id) {
          <option [value]="unit.id">{{ unit.name }} (Parent: {{ unit.parent?.id }})</option>
          } @empty {
          <option disabled>
            @if (ouForm.get('level2')?.value) { No Level 3 units found for selection:
            {{ ouForm.get('level2')?.value }}
            } @else { Please select a Level 2 Unit first. }
          </option>
          }
        </select>
      </div>

      <!-- Level 4 Selector -->
      <div class="form-group">
        <label for="level4" class="block text-sm font-medium text-gray-700 mb-1">
          Level 4 (Branch)
        </label>
        <select
          id="level4"
          formControlName="level4"
          class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
          [class.bg-gray-100]="ouForm.get('level4')?.disabled"
          [disabled]="ouForm.get('level4')?.disabled"
        >
          <option value="" disabled selected>Select Level 4 Unit</option>
          @for (unit of level4Options(); track unit.id) {
          <option [value]="unit.id">{{ unit.name }} (Parent: {{ unit.parent?.id }})</option>
          } @empty {
          <option disabled>
            @if (ouForm.get('level3')?.value) { No Level 4 units found for selection:
            {{ ouForm.get('level3')?.value }}
            } @else { Please select a Level 3 Unit first. }
          </option>
          }
        </select>
      </div>

      <!-- Level 5 Selector -->
      <div class="form-group">
        <label for="level5" class="block text-sm font-medium text-gray-700 mb-1">
          Level 5 (Department)
        </label>
        <select
          id="level5"
          formControlName="level5"
          class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out"
          [class.bg-gray-100]="ouForm.get('level5')?.disabled"
          [disabled]="ouForm.get('level5')?.disabled"
        >
          <option value="" disabled selected>Select Level 5 Unit</option>
          @for (unit of level5Options(); track unit.id) {
          <option [value]="unit.id">{{ unit.name }} (Parent: {{ unit.parent?.id }})</option>
          } @empty {
          <option disabled>
            @if (ouForm.get('level4')?.value) { No Level 5 units found for selection:
            {{ ouForm.get('level4')?.value }}
            } @else { Please select a Level 4 Unit first. }
          </option>
          }
        </select>
      </div>

      <div class="pt-6 border-t mt-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Current Selections</h3>
        <pre class="bg-gray-50 p-4 rounded-lg text-sm whitespace-pre-wrap">{{
          ouForm.value | json
        }}</pre>
      </div>
    </form>
  </div>
</div>
